<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <script src="../build/web/browser/index.js"></script>
  <title>Test</title>
</head>
<body>  
  <p>Open your Console, play with "incognitoJs" library</p>
  <script>
    if (typeof incognitoJs === 'object') {
      async function section(label, f) {
        if (typeof f === 'function') {
          console.time(label);
          console.log(`=========\t${label}\t=========`);
          await f();
          console.timeEnd(label);
          console.log('\n\n');
        }
      }

      function initWallet(incognito) {
        const wallet = new incognito.Wallet();
        wallet.init('pass');

        return wallet;
      }

      function setStorage(incognito) {
        incognito.storage.implement({
          setMethod: (key, data) => {
            return localStorage.setItem(key, data);
          },
          getMethod: (key) => {
            return localStorage.getItem(key);
          },
          removeMethod: (key) => localStorage.removeItem(key),
          namespace: 'WALLET'
        });
      }

      async function main() {
        if (incognitoJs) {
          console.log('Incognito module', incognitoJs);
          await section('LOAD WASM', incognitoJs.loadWASM);

          await section('SET STORAGE', async () => {
            return setStorage(incognitoJs);
          });

          await section('INIT WALLET', async () => {
            const wallet = initWallet(incognitoJs);
            window.wallet = wallet;
            window.masterAccount = wallet.masterAccount;
            window.masterAccount.importAccount('TEST', '112t8rnX54YTL75HRsg6o7zjxLpYKL72iNQTaP5RRWY3VWcGEugSu1be8ApJYVFoW6wy9JeJFjBbodPCchexYTzjLdVYEBFE6XWEggHhKFyd');
            window.masterAccount.importAccount('ICO', '112t8roafGgHL1rhAP9632Yef3sx5k8xgp8cwK4MCJsCL1UWcxXvpzg97N4dwvcD735iKf31Q2ZgrAvKfVjeSUEvnzKJyyJD3GqqSZdxN4or');
            
            // window.account = wallet.masterAccount.child[0];
            window.testAcc = wallet.masterAccount.child[1];
            window.icoAcc = wallet.masterAccount.child[2];
            // window.nativeToken = account.nativeToken;

            window.testAcc.followTokenById('f26b19aeeca6fa87fcd610cc0251ad6b7b209a4b1bc0987d3a74701ec8bb4437');
            window.testAcc.followTokenById('30cce7bcc677f4e598f6518657ffa25528b7d20d2f0a394682003a2f9a5b8674');
            window.testAcc.followTokenById('8073c88c92cde5dc0d198fa0add156df02cdaa169da89397a5a39b48fb548992');

            window.icoAcc.followTokenById('f26b19aeeca6fa87fcd610cc0251ad6b7b209a4b1bc0987d3a74701ec8bb4437');
            window.icoAcc.followTokenById('30cce7bcc677f4e598f6518657ffa25528b7d20d2f0a394682003a2f9a5b8674');
            window.icoAcc.followTokenById('8073c88c92cde5dc0d198fa0add156df02cdaa169da89397a5a39b48fb548992');
            window.icoAcc.followTokenById('60dcb18876927405343024b133879f980fb4a9ef1266b0de909806054e6529b5');

            window.token = await icoAcc.getFollowingPrivacyToken("30cce7bcc677f4e598f6518657ffa25528b7d20d2f0a394682003a2f9a5b8674");
            // console.log('XAXA token.getTotalBalance()', (await token.getTotalBalance()).toNumber())
            // console.log('XAXA token.getAvaiableBalance()', (await token.getAvaiableBalance()).toNumber())
            // console.log('XAXA icoAcc.nativeToken.getTotalBalance()', (await icoAcc.nativeToken.getTotalBalance()).toNumber())
            // console.log('XAXA icoAcc.nativeToken.getAvaiableBalance()', (await icoAcc.nativeToken.getAvaiableBalance()).toNumber())

            // console.log('Wallet', await wallet.getAccounts());
          });
        } else {
          throw new Error('Incognito module load failed');
        }
      }
      main();
    }
    else
      console.log('Load "incognitoJs" module failed, please make sure that you run "yarn build" or "yarn build:web:browser", then try again');
  </script>
</body>
</html>